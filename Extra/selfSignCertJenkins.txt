
Short description: Add Signed Server Certificates to Jenkins Production Environment
Description: Signed certificates will be applied to the Jenkins server led35669, led35662, and led01567 in the production environment.


Step 0 - Snapshot all Jenkins production nodes involved in this change

Then... follow the below process tested on the sandbox (with san.cnf from production for LON, DEN, and SWN servers) on all three server CI's for Jenkins Prod

---------------------
1. Generate a certificate signing request and key using the following command, for example below was for sandbox
 
openssl req -out led35546.west.com.csr -newkey rsa:2048 -nodes -keyout led35546.west.com.key -config jenkins_sandbox.cnf -subj "/C=US/ST=NE/L=Omaha/CN=led35546.west.com"
 
Given the following san.cnf
[ req ]
default_bits         = 2048
distinguished_name   = req_distinguished_name
req_extensions       = req_ext
[ req_distinguished_name ]
[ req_ext ]
subjectAltName  = @alt_names
[alt_names]
DNS.1  = led35546.west.com
IP.1   = 10.50.219.72
 
2. Receive a p7b cert from Infosec named led35546.west.com.p7b
3. Generate a crt file from the p7b from Infosec with the following command,
 
openssl pkcs7 -print_certs -in led35546.west.com.p7b -out led35546.west.com.crt
 
4. Convert crt to a pem
 
openssl x509 -in led35546.west.com.crt -out led35546.west.com.pem -outform PEM 
 
5. Generate a pkcs12  file for this key named jenkins.p12 with the following command.
 
openssl pkcs12 -export -clcerts -in led35546.west.com.pem -inkey led35546.west.com.key -out led35546.west.com.pkcs12 
 
If prompted for a password, enter "sagjenkinsintrado"
 
6. Generate a Java keystore for Jenkins using the following command,
 
keytool -importkeystore -srckeystore led35546.west.com.pkcs12 -srcstoretype pkcs12 -destkeystore led35546.west.com.jks -deststoretype jks
 
If prompted for a password, enter "sagjenkinsintrado"
 
7. Reuse the existing keystore location in /opt/jenkins/.keystore/ and drop led35546.west.com.jks into that location.  Then, make sure the permissions match the existing keystore file that will be swapped out
 
8. Modify the Jenkins config /etc/sysconfig/jenkins to point to this new keystore and restart Jenkins
JENKINS_HTTPS_PORT="8443"
JENKINS_HTTPS_KEYSTORE="/opt/jenkins/.keystore/led35546.west.com.jks"
JENKINS_HTTPS_KEYSTORE_PASSWORD="sagjenkinsintrado"
JENKINS_HTTPS_LISTEN_ADDRESS="0.0.0.0"